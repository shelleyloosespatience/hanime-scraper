{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/impact/Documents/hanime-scraper/app/api/hanime/proxy/route.ts"],"sourcesContent":["// app/api/hanime/proxy/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest) {\n  const url = request.nextUrl.searchParams.get('url');\n  \n  if (!url) {\n    return NextResponse.json({ error: 'No URL provided' }, { status: 400 });\n  }\n\n  try {\n    console.log('Proxying URL:', url);\n    const decodedUrl = decodeURIComponent(url);\n    \n    // Headers to make request look legitimate\n    const headers: HeadersInit = {\n      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n      'Referer': 'https://hanime.tv/',\n      'Origin': 'https://hanime.tv',\n      'Accept': '*/*',\n      'Accept-Language': 'en-US,en;q=0.9',\n      'Sec-Ch-Ua': '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"',\n      'Sec-Ch-Ua-Mobile': '?0',\n      'Sec-Ch-Ua-Platform': '\"Windows\"',\n      'Sec-Fetch-Dest': 'empty',\n      'Sec-Fetch-Mode': 'cors',\n      'Sec-Fetch-Site': 'cross-site',\n    };\n    \n    // Handle range requests for video seeking\n    const range = request.headers.get('range');\n    if (range) {\n      headers['Range'] = range;\n    }\n\n    const response = await fetch(decodedUrl, { \n      headers,\n      redirect: 'follow',\n    });\n\n    if (!response.ok) {\n      console.error(`Proxy failed: ${response.status} for URL: ${decodedUrl}`);\n      return NextResponse.json(\n        { error: `Proxy failed: ${response.status}` },\n        { status: response.status }\n      );\n    }\n\n    const contentType = response.headers.get('content-type') || 'application/octet-stream';\n    \n    // Handle m3u8 playlists - need to rewrite URLs\n    if (contentType.includes('mpegurl') || decodedUrl.includes('.m3u8')) {\n      const text = await response.text();\n      const baseUrl = decodedUrl.substring(0, decodedUrl.lastIndexOf('/'));\n      \n      // Rewrite URLs in the playlist\n      const rewrittenText = text.split('\\n').map(line => {\n        // Skip comments and empty lines\n        if (line.startsWith('#') || line.trim() === '') {\n          return line;\n        }\n        \n        // Handle absolute URLs\n        if (line.startsWith('http')) {\n          return `/api/hanime/proxy?url=${encodeURIComponent(line)}`;\n        }\n        \n        // Handle relative URLs\n        if (line.endsWith('.ts') || line.endsWith('.m3u8')) {\n          const absoluteUrl = new URL(line, baseUrl).toString();\n          return `/api/hanime/proxy?url=${encodeURIComponent(absoluteUrl)}`;\n        }\n        \n        return line;\n      }).join('\\n');\n\n      return new NextResponse(rewrittenText, {\n        status: response.status,\n        headers: {\n          'Content-Type': 'application/vnd.apple.mpegurl',\n          'Access-Control-Allow-Origin': '*',\n          'Cache-Control': 'no-cache',\n        },\n      });\n    }\n\n    // For video segments (.ts files) and other content, stream directly\n    const responseHeaders = new Headers({\n      'Content-Type': contentType,\n      'Access-Control-Allow-Origin': '*',\n      'Cache-Control': 'public, max-age=3600',\n    });\n\n    // Pass through important headers\n    const headersToPass = [\n      'content-length',\n      'content-range',\n      'accept-ranges',\n      'etag',\n      'last-modified',\n    ];\n    \n    headersToPass.forEach(header => {\n      const value = response.headers.get(header);\n      if (value) {\n        responseHeaders.set(header, value);\n      }\n    });\n\n    // Stream the response body\n    return new NextResponse(response.body, {\n      status: response.status,\n      statusText: response.statusText,\n      headers: responseHeaders,\n    });\n  } catch (error: any) {\n    console.error('Proxy error:', error);\n    return NextResponse.json(\n      { error: 'Failed to proxy content', details: error.message },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}